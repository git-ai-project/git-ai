# Commit Message Statistics

This feature automatically adds AI code statistics to your commit messages, helping teams understand AI contribution at a glance.

## Overview

When enabled, git-ai will:
1. Calculate statistics for each commit after it's created
2. Format the statistics according to your configuration
3. Amend the commit message to include the formatted statistics
4. Update the authorship git note to reflect the new commit SHA

## Enabling the Feature

### Via Feature Flag (Required)
The feature is controlled by a feature flag. In debug builds, it's enabled by default. In release builds, it must be explicitly enabled:

```bash
# Enable via environment variable
export GIT_AI_COMMIT_MESSAGE_STATS=true

# Or enable via git-ai config file
git-ai config set feature_flags.commit_message_stats true
```

### Via Git Config (Optional Settings)
Once the feature flag is enabled, you can configure the display format:

```bash
# Set format: "text" or "markdown"
git config ai.commit-message-stats.format text

# Include progress bar (text format only)
git config ai.commit-message-stats.include-progress-bar true

# Include detailed breakdown (markdown format only)
git config ai.commit-message-stats.include-details true

# Set progress bar width (default: 20)
git config ai.commit-message-stats.bar-width 20

# Custom template with placeholders
git config ai.commit-message-stats.template "{original_message}\n\n{stats}"
```

## Configuration Options

### `ai.commit-message-stats.format`
- **Type:** string
- **Default:** "text"
- **Values:** "text" or "markdown"
- **Description:** Output format for statistics

### `ai.commit-message-stats.include-progress-bar`
- **Type:** boolean
- **Default:** true
- **Description:** (Text format only) Include visual progress bar

### `ai.commit-message-stats.include-details`
- **Type:** boolean
- **Default:** true
- **Description:** (Markdown format only) Include detailed breakdown in collapsible section

### `ai.commit-message-stats.bar-width`
- **Type:** integer
- **Default:** 20
- **Description:** Width of the progress bar in characters

### `ai.commit-message-stats.template`
- **Type:** string
- **Default:** "{original_message}\n\n{stats}"
- **Placeholders:**
  - `{original_message}` - The original commit message
  - `{stats}` - The formatted statistics
- **Description:** Template for the final commit message

## Output Examples

### Text Format (Default)
```
Add user authentication

Stats: ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí 60% you, 20% mixed, 20% ai
AI: 3 accepted, 5 generated, waited 1m 5s
```

### Text Format (Without Progress Bar)
```
Add user authentication

Stats: 60% you, 20% mixed, 20% ai
AI: 3 accepted, 5 generated, waited 1m 5s
```

### Markdown Format
```markdown
Add user authentication

```text
üß† you    ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà      60%
ü§ù mixed  ‚ñë‚ñë‚ñà‚ñà‚ñà‚ñà        20%
ü§ñ ai     ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñà‚ñà      20%
```

<details>
<summary>AI Stats</summary>

- 2.5 lines generated for every 1 accepted
- 1 minute 5 seconds waiting for AI

**Model breakdown:**
- claude-3-5-sonnet: 3 accepted, 5 generated
- gpt-4: 2 accepted, 3 generated
</details>
```

### Custom Template
```bash
git config ai.commit-message-stats.template "üìù {original_message}\n\nüìä {stats}"
```

Output:
```
üìù Add user authentication

üìä Stats: ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí 60% you, 20% mixed, 20% ai
AI: 3 accepted, 5 generated, waited 1m 5s
```

## Statistics Calculation

The following statistics are calculated and included:

- **Human additions:** Lines added by human author
- **Mixed additions:** Lines that contain both human and AI modifications
- **AI additions:** Lines added by AI
- **AI accepted:** Number of AI suggestions that were kept
- **Total AI additions:** Total lines generated by AI (including rejected)
- **Time waiting for AI:** Total time spent waiting for AI responses
- **Tool/model breakdown:** Statistics per AI tool and model

## Important Notes

1. **Commit SHA Changes:** When this feature is enabled, commit messages are amended, which changes the commit SHA. This affects:
   - The authorship git note is moved to the new SHA
   - Working logs are updated accordingly
   - Any references to the old SHA need to be updated

2. **Performance:** The feature adds minimal overhead:
   - Stats calculation: ~10-50ms per commit
   - Commit amend: ~10-20ms
   - Total: ~20-70ms per commit

3. **Compatibility:** Works with all supported AI agents (Claude Code, Cursor, Copilot, Gemini, etc.)

4. **Remote Sync:** The updated commit message and authorship note will be pushed to remote when you run `git push` (if git-ai sync is enabled)

## Disabling the Feature

To disable the feature entirely:

```bash
# Disable via feature flag
git-ai config set feature_flags.commit_message_stats false

# Or unset the feature flag
git-ai config unset feature_flags.commit_message_stats
```

Or disable via environment variable:

```bash
unset GIT_AI_COMMIT_MESSAGE_STATS
```

## Troubleshooting

### Feature not working?
1. Check if the feature flag is enabled: `git-ai config get feature_flags.commit_message_stats`
2. Check for errors in debug log: `export GIT_AI_DEBUG=1` then commit

### Commit message too long?
Use a custom template to limit the output:
```bash
git config ai.commit-message-stats.template "{original_message}\n\n{stats}"
git config ai.commit-message-stats.include-details false
```

### Want to preserve original message?
The feature always preserves your original message and appends statistics. If you want different behavior, use a custom template.
